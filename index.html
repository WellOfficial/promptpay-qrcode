<!DOCTYPE html>
<html lang="th" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>PromptPay Pro</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#020617">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="icon.png">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Sarabun:wght@300;400;600&display=swap" rel="stylesheet">
    
    <style>
        /* Base Settings */
        body { 
            font-family: 'Inter', 'Sarabun', sans-serif; 
            background-color: #020617; /* Slate 950 */
            color: #ffffff;
            overscroll-behavior-y: none; /* Prevent Pull-to-refresh */
        }
        
        /* Disable Input Arrows */
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        input[type=number] { -moz-appearance: textfield; }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 3px; }

        /* Animations */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-enter { animation: fadeIn 0.5s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        
        @keyframes pulse-border {
            0% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(59, 130, 246, 0); }
            100% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0); }
        }
        .scan-active { animation: pulse-border 2s infinite; }
    </style>
</head>
<body class="min-h-[100dvh] flex flex-col lg:flex-row overflow-hidden">

    <section class="w-full lg:w-1/2 h-auto lg:h-full p-6 lg:p-12 flex flex-col justify-center relative z-10 bg-[#020617]">
        
        <div class="mb-8 lg:mb-12 flex items-center gap-3 animate-enter" style="animation-delay: 0.1s;">
            <div class="w-10 h-10 rounded-xl bg-blue-600 flex items-center justify-center shadow-lg shadow-blue-900/50">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                </svg>
            </div>
            <div>
                <h1 class="text-xl font-bold tracking-tight">PromptPay<span class="text-blue-500">Pro</span></h1>
                <p class="text-xs text-slate-400 font-light">Rapid Payment Generator</p>
            </div>
        </div>

        <div class="space-y-8 animate-enter" style="animation-delay: 0.2s;">
            
            <div class="relative group">
                <label class="block text-blue-400 text-xs font-semibold tracking-wider mb-2 uppercase">Amount to Receive</label>
                <div class="relative">
                    <input type="number" id="pp-amount" placeholder="0.00" inputmode="decimal"
                        class="w-full bg-transparent border-b-2 border-slate-700 text-5xl lg:text-7xl font-light text-white placeholder-slate-800 focus:border-blue-500 focus:outline-none transition-colors py-2"
                        oninput="validateAndGenerate()">
                    <span class="absolute right-0 bottom-4 text-slate-500 text-lg font-medium">THB</span>
                </div>
            </div>

            <div class="bg-slate-900/50 p-4 rounded-2xl border border-slate-800 hover:border-slate-700 transition-colors">
                <div class="flex items-center justify-between mb-2">
                    <label class="text-slate-400 text-xs font-semibold uppercase">Linked Account (ID)</label>
                    <div class="h-2 w-2 rounded-full bg-green-500 shadow-[0_0_8px_rgba(34,197,94,0.6)]"></div>
                </div>
                <input type="tel" id="pp-id" placeholder="Phone or Thai ID" 
                    class="w-full bg-transparent text-lg text-slate-200 placeholder-slate-600 focus:outline-none font-mono tracking-wide"
                    oninput="validateAndGenerate()">
            </div>
        </div>

        <div class="mt-auto pt-8 text-slate-600 text-xs font-light animate-enter lg:block hidden" style="animation-delay: 0.3s;">
            Secure Client-Side Generation â€¢ EMVCo Standard Compliant
        </div>
    </section>

    <section class="w-full lg:w-1/2 h-auto lg:h-full bg-gradient-to-br from-slate-900 to-[#0B1121] relative flex items-center justify-center p-6 lg:p-0 rounded-t-[2.5rem] lg:rounded-none border-t border-slate-800 lg:border-t-0 lg:border-l shadow-[0_-10px_40px_rgba(0,0,0,0.5)] lg:shadow-none z-20">
        
        <div class="absolute inset-0 overflow-hidden pointer-events-none">
            <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[500px] h-[500px] bg-blue-600/10 rounded-full blur-[100px]"></div>
        </div>

        <div id="qr-card" class="relative bg-white p-6 rounded-3xl shadow-2xl w-full max-w-[340px] transform transition-all duration-500 opacity-50 scale-95 blur-sm grayscale">
            
            <div class="flex items-center justify-between mb-6">
                <img src="https://upload.wikimedia.org/wikipedia/commons/c/c5/PromptPay-logo.png" alt="PromptPay" class="h-8 object-contain">
                <div class="text-right">
                    <div class="text-[10px] text-gray-400 font-semibold uppercase">Scan via Banking App</div>
                </div>
            </div>

            <div class="aspect-square bg-gray-50 rounded-xl flex items-center justify-center border border-gray-100 mb-6 relative overflow-hidden group">
                <div id="qrcode" class="opacity-80 transition-opacity duration-300"></div>
                
                <div id="qr-placeholder" class="absolute inset-0 flex flex-col items-center justify-center text-gray-300">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mb-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z" />
                    </svg>
                    <span class="text-xs font-medium">Waiting for input</span>
                </div>
            </div>

            <div class="flex justify-between items-end border-t border-gray-100 pt-4">
                <div>
                    <div class="text-[10px] text-gray-400 uppercase tracking-wide">Total Amount</div>
                    <div class="text-2xl font-bold text-gray-900 leading-none mt-1" id="card-amount">0.00</div>
                </div>
                <div class="text-xs text-gray-400 font-medium">THB</div>
            </div>
            
            <button onclick="downloadQR()" class="mt-4 w-full py-3 rounded-xl bg-slate-900 text-white text-sm font-semibold hover:bg-slate-800 active:scale-95 transition-all flex items-center justify-center gap-2">
                Save Image
            </button>
        </div>

    </section>

    <script>
        // --- Service Worker & PWA Init ---
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js').catch(() => {});
        }

        // --- Logic ---
        function crc16(data) {
            let crc = 0xFFFF;
            for (let i = 0; i < data.length; i++) {
                let x = ((crc >> 8) ^ data.charCodeAt(i)) & 0xFF;
                x ^= x >> 4;
                crc = ((crc << 8) ^ (x << 12) ^ (x << 5) ^ x) & 0xFFFF;
            }
            return crc.toString(16).toUpperCase().padStart(4, '0');
        }

        function generatePayload(target, amount) {
            target = target.replace(/[^0-9]/g, '');
            let targetType = '';
            if (target.length === 10 && target.startsWith('0')) {
                targetType = '01'; target = '0066' + target.substring(1); 
            } else if (target.length === 13) { targetType = '02'; } else { return null; }

            let fAmount = '';
            if (amount) { fAmount = parseFloat(amount).toFixed(2); }

            const data = [ '000201', amount ? '010212' : '010211', '2937', '0016A000000677010111', targetType + String(target.length).padStart(2, '0') + target, '5802TH', '5303764' ];
            if (fAmount) { data.push('54' + String(fAmount.length).padStart(2, '0') + fAmount); }

            let payload = data.join('') + '6304';
            payload += crc16(payload); 
            return payload;
        }

        // Elements
        const ppId = document.getElementById('pp-id');
        const ppAmount = document.getElementById('pp-amount');
        const qrDiv = document.getElementById('qrcode');
        const qrPlaceholder = document.getElementById('qr-placeholder');
        const qrCard = document.getElementById('qr-card');
        const cardAmount = document.getElementById('card-amount');

        // Init
        window.onload = function() {
            const savedId = localStorage.getItem('pro_pp_id');
            if (savedId) { ppId.value = savedId; validateAndGenerate(); }
            // Auto focus on amount for quick use
            setTimeout(() => ppAmount.focus(), 500); 
        };

        function validateAndGenerate() {
            const id = ppId.value.trim();
            const amountVal = ppAmount.value.trim();
            
            localStorage.setItem('pro_pp_id', id);

            // Update Card Text
            cardAmount.innerText = amountVal ? parseFloat(amountVal).toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2}) : '0.00';

            const payload = generatePayload(id, amountVal);
            qrDiv.innerHTML = ""; 

            if (payload) {
                // Active State
                qrCard.classList.remove('opacity-50', 'scale-95', 'blur-sm', 'grayscale');
                qrCard.classList.add('scan-active'); // Add pulse
                qrPlaceholder.classList.add('hidden');
                qrDiv.classList.remove('opacity-80');
                
                new QRCode(qrDiv, { 
                    text: payload, 
                    width: 250, 
                    height: 250, 
                    colorDark : "#000000", 
                    colorLight : "#ffffff", 
                    correctLevel : QRCode.CorrectLevel.L 
                });
            } else {
                // Inactive State
                qrCard.classList.add('opacity-50', 'scale-95', 'blur-sm', 'grayscale');
                qrCard.classList.remove('scan-active');
                qrPlaceholder.classList.remove('hidden');
                qrDiv.classList.add('opacity-80');
            }
        }

        function downloadQR() {
            const img = qrDiv.querySelector('img');
            if (img && img.src) {
                const link = document.createElement('a');
                link.href = img.src;
                link.download = `PromptPay_${ppAmount.value || 'Open'}.png`;
                link.click();
            }
        }
    </script>
</body>
</html>
